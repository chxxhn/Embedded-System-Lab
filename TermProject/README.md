# 🗑️ 스마트 무게 감지 쓰레기통

이 프로젝트는 **STM32F107VCT6 개발 보드**를 이용하여 **자동 개폐 및 무게 감지 기능이 있는 스마트 쓰레기통**을 구현하는 프로젝트입니다.  
초음파 거리 센서와 압력 센서를 활용하여 쓰레기통의 상태를 모니터링하고, LCD 디스플레이 및 블루투스 모듈을 이용해 사용자에게 알림을 제공합니다.

---

## 📌 프로젝트 개요

### 🎯 목표
- **자동 개폐 시스템**: 초음파 센서를 통해 손이나 물체를 감지하면 뚜껑이 자동으로 열리고, 일정 시간이 지나면 닫힘.
- **무게 감지 및 경고 알람**: 압력 센서를 사용해 쓰레기통의 무게를 측정하고, 일정 무게를 초과하면 블루투스를 통해 스마트폰으로 알림 전송.
- **LCD 디스플레이 상태 표시**: 무게 상태에 따라 LCD에 쓰레기통 상태(행복한 얼굴/화난 얼굴)를 표시.

### 🛠 사용 기술 및 하드웨어
- **MCU**: STM32F107VCT6
- **센서**: HC-SR04 초음파 센서, FSR 402 압력 센서
- **모터 제어**: DC 모터 & L298N 모터 드라이버
- **디스플레이**: 1602 LCD 모듈
- **통신**: 블루투스 (USART 사용)


---

## 🛠 프로젝트 설정

### 1️⃣ **초음파 센서를 이용한 뚜껑 자동 개폐**
- **HC-SR04 초음파 센서**를 사용하여 일정 거리 내에 물체가 감지되면 **DC 모터를 작동**하여 뚜껑을 엽니다.
- 손이 쓰레기통에서 멀어지면 모터가 역방향으로 작동하여 뚜껑을 닫습니다.

```c
float Get_Distance(void) {
    uint32_t start_time, end_time;

    // TRIG 핀 HIGH로 10us 신호 송출
    GPIO_SetBits(GPIOA, GPIO_Pin_0);
    Delay_us(10);
    GPIO_ResetBits(GPIOA, GPIO_Pin_0);

    // ECHO 핀 HIGH 상태 대기
    while (GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_1) == Bit_RESET);
    start_time = TIM_GetCounter(TIM2);

    // ECHO 핀 LOW 상태 대기
    while (GPIO_ReadInputDataBit(GPIOA, GPIO_Pin_1) == Bit_SET);
    end_time = TIM_GetCounter(TIM2);

    // 거리 계산
    return ((end_time - start_time) * 0.0343f) / 2.0f;
}
```

### 2️⃣ **압력 센서를 이용한 무게 감지**
- **FSR 402 압력 센서**를 이용하여 쓰레기통의 무게를 측정합니다.
- 일정 무게를 초과하면 LCD에 경고 표정을 출력하고, 블루투스를 통해 알림을 전송합니다.

```c
uint16_t Read_ADC_Value(void) {
    while (ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);
    return ADC_GetConversionValue(ADC1);
}
```

### 3️⃣ **LCD 디스플레이로 상태 표시**
- 쓰레기통의 상태에 따라 LCD 화면에 "🙂" 또는 "😡"을 표시합니다.

```c
void LCD_DrawHappyFace(void) {
    LCD_Clear(WHITE);
    LCD_ShowString(40, 50, "🙂 쓰레기통 상태: 양호", BLACK, WHITE);
}

void LCD_DrawAngryFace(void) {
    LCD_Clear(WHITE);
    LCD_ShowString(40, 50, "😡 쓰레기통이 가득 찼습니다!", RED, WHITE);
}
```

### 4️⃣ **블루투스를 이용한 스마트 알림**
- 일정 무게를 초과하면 블루투스를 통해 스마트폰으로 "쓰레기를 비워주세요!" 메시지를 전송합니다.

```c
void bt_send_to_user(char *message) {
    for (int i = 0; message[i] != '\0'; i++) {
        while ((USART2->SR & USART_SR_TXE) == 0);
        USART_SendData(USART2, message[i]);
    }
}
```

---

## 📝 실험 과정
1. **초음파 센서 설정**
   - 물체 감지 시 모터를 작동하여 **뚜껑이 자동 개폐**되는 코드 작성.
   - **HC-SR04 초음파 센서**를 활용하여 손이나 물체의 거리를 측정.
   - **5cm 이내 감지 시 뚜껑 열림**, 물체가 사라지면 일정 시간 후 **뚜껑 닫힘**.

2. **모터 제어**
   - **DC 모터와 모터 드라이버**를 활용해 **뚜껑이 부드럽게 열리고 닫히도록** 설정.
   - 초음파 센서가 특정 거리 내 물체를 감지하면 **모터를 정방향**으로 회전.
   - 일정 시간이 지나면 **모터가 역방향**으로 회전하여 뚜껑이 닫힘.

3. **압력 센서 테스트**
   - **FSR 402 압력 센서**를 사용하여 쓰레기 추가 시 무게 변화를 감지.
   - **ADC 값을 측정**하여 쓰레기의 무게 변화를 실시간으로 파악.
   - 일정 무게 이상이면 **LCD 및 블루투스 알림 기능이 작동**하도록 설정.

4. **LCD 인터페이스 구축**
   - 쓰레기통의 상태에 따라 **LCD 화면에 표정 출력**.
   - 정상 상태 → 😃 "쓰레기통 상태: 양호"
   - 쓰레기통이 가득 찼을 때 → 😡 "쓰레기통이 가득 찼습니다!"

5. **블루투스 연결**
   - 쓰레기 무게가 일정 값(임계값)을 초과하면 **스마트폰으로 알림을 전송**.
   - **Bluetooth 모듈을 사용하여 무게 상태를 사용자에게 실시간으로 전달**.

---

## 📊 실험 결과
✅ **정상 작동 확인**

| 동작 | 결과 |
|------|------|
| 손을 가까이 가져가면 | ✅ 뚜껑 자동 개방 |
| 손을 떼면 | ✅ 뚜껑 자동 닫힘 |
| 쓰레기를 추가하면 | ✅ 무게 측정 정상 작동 |
| 일정 무게 초과 시 | ✅ LCD에 화난 얼굴 표시 + 블루투스 알람 전송 |

📢 **스마트폰 알림 예시**
```
🔔 알림: 쓰레기통이 가득 찼습니다! 지금 비워주세요!
```

---

## 🚀 프로젝트 개선 방향
- 📌 **모터 속도 조절**: 뚜껑이 너무 빠르게 닫히는 문제 해결을 위해 **PWM(Pulse Width Modulation)**을 활용한 속도 제어 기능 추가.
- 📌 **배터리 절약 기능 추가**: **센서가 활성화될 때만 전력을 공급**하도록 전력 관리 기능 개선.
- 📌 **모바일 앱 연동**: **스마트폰 앱을 통해 실시간 무게 상태 확인 기능 추가**하여 사용자 편의성 향상.





